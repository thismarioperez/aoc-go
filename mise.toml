[tools]
go = "1.25.4"

[env]
_.path = ["./bin"]

[tasks.build]
description = "Build the CLI"
run = "go build -o bin/aoc ./cmd/aoc"

[tasks.solve]
description = "Run solution(s) - usage: mise run solve [year] [day]"
depends = ["build"]
run = """
#!/usr/bin/env bash
./bin/aoc -year="{{arg(i=0, name='year')}}" -day="{{arg(i=1, name='day', default='0')}}"
"""

[tasks.test]
description = "Run all tests"
run = "go test ./..."

[tasks.test-day]
description = "Run tests for specific day - usage: mise run test-day <year> <day>"
run = """
#!/usr/bin/env bash
YEAR="{{arg(i=0, name='year')}}"
DAY="{{arg(i=1, name='day')}}"
DAY_PADDED=$(printf '%02d' "$DAY")
go test "./years/$YEAR/day$DAY_PADDED/..."
"""

[tasks.bench]
description = "Run benchmarks"
run = "go test -bench=. -benchmem ./..."

[tasks.clean]
description = "Clean build artifacts"
run = "rm -rf bin/"

[tasks.new-day]
description = "Create a new day from template - usage: mise run new-day <year> <day>"
run = """
#!/usr/bin/env bash
YEAR="{{arg(i=0, name='year')}}"
DAY="{{arg(i=1, name='day')}}"

DAY_PADDED=$(printf '%02d' "$DAY")
DIR="years/$YEAR/day$DAY_PADDED"

mkdir -p "$DIR"

if [[ ! -f "$DIR/solution.go" ]]; then
  sed "s/day01/day$DAY_PADDED/g; s/2025/$YEAR/g; s/Register($YEAR, 1,/Register($YEAR, $DAY,/g" \
    years/2025/day01/solution.go > "$DIR/solution.go"
  echo "Created $DIR/solution.go"
else
  echo "$DIR/solution.go already exists"
fi

if [[ ! -f "$DIR/solution_test.go" ]]; then
  sed "s/day01/day$DAY_PADDED/g" \
    years/2025/day01/solution_test.go > "$DIR/solution_test.go"
  echo "Created $DIR/solution_test.go"
else
  echo "$DIR/solution_test.go already exists"
fi

touch "$DIR/input.txt"

echo ""
echo "Don't forget to add the import to years/register.go:"
echo "  _ \"aoc/years/$YEAR/day$DAY_PADDED\""
"""

[tasks.download]
description = "Download input - usage: mise run download <year> <day>"
run = """
#!/usr/bin/env bash
if [[ -z "$AOC_SESSION" ]]; then
  echo "Set AOC_SESSION environment variable with your session cookie"
  exit 1
fi

YEAR="{{arg(i=0, name='year')}}"
DAY="{{arg(i=1, name='day')}}"

DAY_PADDED=$(printf '%02d' "$DAY")
DIR="years/$YEAR/day$DAY_PADDED"

mkdir -p "$DIR"
curl -s -b "session=$AOC_SESSION" \
  "https://adventofcode.com/$YEAR/day/$DAY/input" > "$DIR/input.txt"
echo "Downloaded input to $DIR/input.txt"
"""
